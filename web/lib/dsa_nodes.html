<!DOCTYPE html>
<link rel="import" href="packages/core_elements/core_list_dart.html">
<link rel="import" href="material_card.html">
<link rel="import" href="packages/paper_elements/paper_button.html">
<link rel="import" href="packages/paper_elements/paper_dialog.html">
<link rel="import" href="packages/paper_elements/paper_input.html">

<polymer-element name="dsa-nodes" attributes="path">
  <template>
    <style>
      :host {
        width: 256px;
        height: 256px;
        visibility: visible;
      }

      material-card {
        width: 250px;
      }

      material-card::shadow .content {
        background-color: #03A9F4;
        color: #FFF;
        padding: 10px;
      }

      core-list {
        display: block;
        height: 100%;
        margin: 0 auto;
      }

      paper-button {
        z-index: 2 !important;
      }
    </style>

    <core-list-dart id="list" vertical layout fit data="{{nodez}}">
      <template>
        <material-card autoraise path="{{model.path}}">
          <h2>{{model.name}}</h2>

          <p>
            <template if="{{model.isInvokable}}">
              Invokable<br/>
            </template>

            <template if="{{model.hasValue}}">
              Type: {{model.type}}<br/>
              Value: {{model.valueAsString(model.value)}}<br/>
            </template>
          </p>

          <div horizontal end-justified layout>
            <template if="{{model.hasChildren}}">
              <paper-button class="node-open" id="node-button" on-click="{{onNodeClicked}}">View Children</paper-button>
            </template>

            <template if="{{model.hasValue}}">
              <paper-button class="node-open" id="watch-value" on-click="{{onWatchValueClicked}}">Watch Value</paper-button>
            </template>

            <template if="{{model.isInvokable}}">
              <paper-button class="node-invoke" id="invoke-btn" on-click="{{onInvokeClicked}}">Invoke</paper-button>
            </template>
            
            <paper-button class="node-view" id="node-view" on-click="{{onViewNodeClicked}}">View Node</paper-button>
          </div>

          <paper-dialog id="watch-dialog" heading="{{model.path}}" autofocus>
            <div horizontal center-justified layout>
              <p style="font-size: 70px; font-weight: bold;">{{model.valueAsString(model.value)}}</p>
            </div>

            <div horizontal end-justified layout>
              <paper-button id="close-watch-dialog" on-click="{{closeDialog}}" dismissive>Close</paper-button>
            </div>
          </paper-dialog>

          <paper-dialog id="invoke-dialog" data-path="{{model.path}}" heading="Invoke {{model.path}}" autofocus>
            <template if="{{model.isInvokable}}">
            <template repeat="{{param in model.params}}">
              <paper-input class="action-param" data-key="{{param.name}}" label="{{param.defaultValue}}"></paper-input>
            </template>
            </template>

            <div horizontal end-justified layout>
              <paper-button id="invoke-action" on-click="{{invokeAction}}">Invoke</paper-button>
              <paper-button id="close-invoke-dialog" on-click="{{closeDialog}}" dismissive>Close</paper-button>
            </div>
          </paper-dialog>

          <paper-dialog id="invoke-value-dialog" data-path="{{model.path}}" heading="Invoke Result">
            <div horizontal center-justified layout>
              <p id="value" style="font-size: 70px; font-weight: bold;"></p>
            </div>
          </paper-dialog>

          <paper-dialog transition="paper-dialog-transition-center" backdrop="true" id="dialog" heading="{{model.path}}" autofocus>
            <div style="width: 600px;">
              <h4>Configurations</h4>

              <p>
                <template repeat="{{key in model.configs.keys}}">
                  {{key}}: {{model.configs[key]}}<br/>
                </template>
              </p>
            </div>

            <template if="{{model.attributes.isNotEmpty}}">
              <div style="width: 600px;">
                <h4>Attributes</h4>

                <p>
                  <template repeat="{{key in model.attributes.keys}}">
                    {{key}}: {{model.attributes[key]}}<br/>
                  </template>
                </p>
              </div>
            </template>

            <div horizontal end-justified layout>
              <paper-button id="close-dialog" on-click="{{closeDialog}}" dismissive>Close</paper-button>
            </div>
          </paper-dialog>
        </material-card>
      </template>
    </core-list-dart>
  </template>

  <script type="application/dart" src="dsa_nodes.dart"></script>
</polymer-element>
